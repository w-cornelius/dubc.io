<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Size Calculator</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* General Body Styling & Font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
        }

        /* --- Radiating Background Animation --- */
        body::before {
            content: '';
            position: fixed;
            z-index: -1;
            top: 50%;
            left: 50%;
            width: 80vmax;
            height: 80vmax;
            border-radius: 50%;
            background-color: rgba(120, 50, 220, 0.25);
            animation: radiate 8s ease-in-out infinite;
            filter: blur(100px);
        }

        @keyframes radiate {
            0%, 100% {
                transform: translate(-50%, -50%) scale(0.95);
                opacity: 0.9;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 1;
            }
        }

        /* --- Glassmorphism Effect --- */
        .glassmorphic {
            background: rgba(10, 10, 10, 0.5);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* --- Entrance Animations --- */
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fade-slide-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fade-in 0.8s ease-out forwards;
        }
        .animate-fade-slide-up {
            opacity: 0; /* Start hidden */
            animation: fade-slide-up 0.6s ease-out forwards;
        }

        /* --- Enhanced Link/Button Styling --- */
        .social-link {
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .social-link:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.1);
        }

        /* Shimmer effect on hover */
        .social-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -150%;
            width: 75%;
            height: 100%;
            background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.2) 50%, rgba(255, 255, 255, 0) 100%);
            transform: skewX(-25deg);
            transition: left 0.6s ease;
        }
        .social-link:hover::before {
            left: 150%;
        }

        /* Custom styles for number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Modal Scrollbar */
        #modal-content .p-6::-webkit-scrollbar { width: 8px; }
        #modal-content .p-6::-webkit-scrollbar-track { background: #2d3748; }
        #modal-content .p-6::-webkit-scrollbar-thumb { background-color: #4a5568; border-radius: 4px; border: 2px solid #2d3748; }
        #modal-content .p-6::-webkit-scrollbar-thumb:hover { background: #718096; }
    </style>
</head>
<body class="text-white antialiased">

    <div class="relative min-h-screen flex flex-col items-center justify-center p-4">
        
        <!-- Main content container -->
        <div class="relative z-10 w-full max-w-4xl mx-auto pt-10 pb-24">
            
            <!-- Page Header -->
            <header class="text-center mb-10 animate-fade-in">
                <!-- Calculator Icon -->
                <svg class="w-32 mx-auto mb-5 shadow-2xl text-purple-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75l-2.489-2.489m0 0a3.375 3.375 0 10-4.773-4.773 3.375 3.375 0 004.773 4.773zM12 19.5h-2.25A2.25 2.25 0 017.5 17.25V6.75A2.25 2.25 0 019.75 4.5h4.5a2.25 2.25 0 012.25 2.25v10.5a2.25 2.25 0 01-2.25 2.25H12z" />
                </svg>
                <h1 class="text-4xl font-bold text-white tracking-tight">Video Size & Bitrate Calculator</h1>
                <p class="text-gray-300 mt-2 text-lg">Estimate file sizes and bitrates for your renders.</p>
            </header>

            <!-- Calculator Body -->
            <div class="w-full glassmorphic rounded-2xl shadow-2xl p-6 md:p-8">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <!-- Card 1: Estimate Final Size from Sample -->
                    <div class="glassmorphic rounded-lg p-6 shadow-inner">
                        <h2 class="text-2xl font-semibold mb-4 text-white">A. Estimate Final Size</h2>
                        <p class="text-sm text-gray-400 mb-5">Calculates the total file size based on a small sample render.</p>

                        <!-- Total Video Length -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Total Video Length (HH:MM:SS)</label>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="number" id="total_hh" placeholder="HH" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0">
                                <input type="number" id="total_mm" placeholder="MM" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0" max="59">
                                <input type="number" id="total_ss" placeholder="SS" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0" max="59">
                            </div>
                        </div>

                        <!-- Sample Video Length -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Sample Length (HH:MM:SS)</label>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="number" id="sample_hh" placeholder="HH" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0">
                                <input type="number" id="sample_mm" placeholder="MM" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0" max="59">
                                <input type="number" id="sample_ss" placeholder="SS" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0" max="59">
                            </div>
                        </div>

                        <!-- Sample File Size -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Sample File Size</label>
                            <div class="flex">
                                <input type="number" id="sample_size" placeholder="e.g., 256871" class="w-2/3 p-2 border border-white/20 rounded-l-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0">
                                <select id="sample_unit" class="w-1/3 p-2 border border-l-0 border-white/20 rounded-r-md bg-black/30 text-white focus:ring-teal-500 focus:border-teal-500">
                                    <option value="KB" selected>KB</option>
                                    <option value="MB">MB</option>
                                    <option value="GB">GB</option>
                                </select>
                            </div>
                        </div>

                        <!-- Calculate Button -->
                        <button id="calculate_size" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-md hover:bg-teal-700 transition duration-300 uppercase tracking-wide">
                            Calculate Size
                        </button>

                        <!-- Result Display -->
                        <div id="size_result_wrapper" class="mt-5 p-4 bg-black/20 rounded-md text-center hidden">
                            <span class="block text-sm font-medium text-gray-400">Estimated Final Size:</span>
                            <span id="size_result" class="block text-3xl font-bold text-teal-300"></span>
                        </div>
                    </div>

                    <!-- Card 2: Find Required Bitrate -->
                    <div class="glassmorphic rounded-lg p-6 shadow-inner">
                        <h2 class="text-2xl font-semibold mb-4 text-white">B. Find Required Bitrate</h2>
                        <p class="text-sm text-gray-400 mb-5">Calculates the video bitrate needed to hit a target file size.</p>

                        <!-- Target Video Length -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Total Video Length (HH:MM:SS)</label>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="number" id="target_hh" placeholder="HH" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0">
                                <input type="number" id="target_mm" placeholder="MM" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0" max="59">
                                <input type="number" id="target_ss" placeholder="SS" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0" max="59">
                            </div>
                        </div>

                        <!-- Target File Size -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Target File Size</label>
                            <div class="flex">
                                <input type="number" id="target_size" placeholder="e.g., 99" class="w-2/3 p-2 border border-white/20 rounded-l-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0">
                                <select id="target_unit" class="w-1/3 p-2 border border-l-0 border-white/20 rounded-r-md bg-black/30 text-white focus:ring-teal-500 focus:border-teal-500">
                                    <option value="MB">MB</option>
                                    <option value="GB" selected>GB</option>
                                    <option value="TB">TB</option>
                                </select>
                            </div>
                        </div>

                        <!-- Audio Bitrate -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Audio Bitrate (in kbps)</label>
                            <input type="number" id="audio_bitrate" value="320" class="w-full p-2 border border-white/20 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 bg-black/30 text-white" min="0">
                        </div>

                        <!-- Calculate Button -->
                        <button id="calculate_bitrate" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-md hover:bg-teal-700 transition duration-300 uppercase tracking-wide">
                            Calculate Bitrate
                        </button>

                        <!-- Result Display -->
                        <div id="bitrate_result_wrapper" class="mt-5 p-4 bg-black/20 rounded-md text-center hidden">
                            <span class="block text-sm font-medium text-gray-400">Required Video Bitrate:</span>
                            <span id="bitrate_result" class="block text-3xl font-bold text-teal-300"></span>
                        </div>
                    </div>
                </div>

                <!-- Footer Note -->
                <p class="text-center text-xs text-gray-400 mt-6">
                    All calculations use the 1024 (binary) conversion (i.e., 1 GB = 1024 MB, 1 MB = 1024 KB),
                    which is how operating systems report file sizes.
                </p>

                <!-- New Link Section -->
                <p class="text-center text-sm text-gray-400 mt-4">
                    Need to know the upload limit for your site? 
                    <a href="https://wyzowl.com/social-media-video-specs/" target="_blank" rel="noopener noreferrer" class="text-teal-300 hover:text-teal-400 underline transition-colors duration-200">
                        Check this guide to social media video specs.
                    </a>
                </p>
            </div>

            <!-- Navigation Links -->
            <section class="mt-10 text-center animate-fade-slide-up" style="animation-delay: 0.5s;">
                <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                    <!-- Ask AI Button -->
                    <button id="ask-ai-btn" class="social-link group flex items-center justify-center p-4 glassmorphic rounded-xl text-lg font-semibold w-full sm:w-auto">
                        <svg class="w-6 h-6 mr-3 text-teal-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.5a.75.75 0 01.75.75v.31a10.493 10.493 0 015.484 2.836.75.75 0 01-.976 1.138 9.001 9.001 0 00-10.517 0 .75.75 0 01-.976-1.138A10.493 10.493 0 0111.25 3.56V3.25a.75.75 0 01.75-.75zM7.757 8.243a.75.75 0 011.06 0l1.158 1.158a.75.75 0 010 1.06l-1.158 1.159a.75.75 0 01-1.06-1.061l.628-.629-.628-.628a.75.75 0 010-1.06zM12 8.25a.75.75 0 01.75.75v3a.75.75 0 01-1.5 0v-3a.75.75 0 01.75-.75zm4.183.993a.75.75 0 010 1.06l-.628.628.628.629a.75.75 0 11-1.06 1.06l-1.159-1.158a.75.75 0 010-1.061l1.159-1.158a.75.75 0 011.06 0zM12 15.75a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM5.75 18a.75.75 0 00-.75.75v.31a10.493 10.493 0 005.484 2.836.75.75 0 10.582-1.322 9 9 0 01-4.823-2.574V18.75a.75.75 0 00-.5-.75zm12.5 0a.75.75 0 00-.5.75v.25a9 9 0 01-4.823 2.574.75.75 0 10.582 1.322A10.493 10.493 0 0018.25 19.06v-.31a.75.75 0 00-.75-.75z"></path></svg>
                        <span>Ask AI</span>
                    </button>
                    <!-- Back to Home -->
                    <a href="index.html" class="social-link inline-block p-4 glassmorphic rounded-xl text-lg font-semibold w-full sm:w-auto">
                        &larr; Back to Home
                    </a>
                </div>
            </section>
        </div>
        
        <!-- Footer -->
        <footer class="absolute bottom-6 w-full text-center text-gray-500 text-sm animate-fade-in z-20" style="animation-delay: 0.6s;">
            <p>&copy; 2025 dubbb_c. All Rights Reserved.</p>
            <div class="flex justify-center space-x-4 mt-1">
                <a href="/security.html" class="hover:text-white transition-colors">Security</a>
                <a href="hall-of-fame.html" class="hover:text-white transition-colors">Hall of Fame</a>
            </div>
        </footer>

    </div>

    <!-- AI Modal -->
    <div id="ai-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 hidden transition-opacity duration-300 opacity-0">
        <div class="glassmorphic rounded-2xl shadow-2xl w-full max-w-lg transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <!-- Modal Header -->
            <div class="flex items-center justify-between p-4 border-b border-white/10">
                <h3 class="text-xl font-bold" id="modal-title">âœ¨ Ask AI (Video Expert)</h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <!-- Modal Body -->
            <div class="p-6 max-h-[60vh] overflow-y-auto">
                <div class="space-y-4">
                    <input type="text" id="ai-question-input" placeholder="e.g., What is a good bitrate for 1080p?" class="w-full p-3 bg-black/30 rounded-lg border border-white/20 focus:outline-none focus:ring-2 focus:ring-teal-500">
                    <button id="submit-ai-question-btn" class="w-full px-4 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors duration-300 font-semibold">Get Answer</button>
                </div>
                <div id="modal-loader" class="flex justify-center items-center h-32 hidden mt-4">
                    <svg class="animate-spin h-10 w-10 text-purple-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>
                <div id="modal-result-container" class="mt-4 hidden">
                    <p id="modal-text" class="text-gray-300 text-base whitespace-pre-wrap bg-black/20 p-4 rounded-lg"></p>
                </div>
            </div>
            <!-- Modal Footer -->
            <div id="modal-footer" class="flex justify-end p-4 border-t border-white/10 hidden">
                <button id="copy-btn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-300">Copy Text</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Calculator Helper Functions ---

            function parseTimeToSeconds(hh_id, mm_id, ss_id) {
                const hh = parseInt(document.getElementById(hh_id).value) || 0;
                const mm = parseInt(document.getElementById(mm_id).value) || 0;
                const ss = parseInt(document.getElementById(ss_id).value) || 0;
                return (hh * 3600) + (mm * 60) + ss;
            }

            function parseSizeToKB(size_id, unit_id) {
                const size = parseFloat(document.getElementById(size_id).value) || 0;
                const unit = document.getElementById(unit_id).value;
                switch (unit) {
                    case 'MB': return size * 1024;
                    case 'GB': return size * 1024 * 1024;
                    case 'TB': return size * 1024 * 1024 * 1024;
                    case 'KB':
                    default:   return size;
                }
            }

            function formatSize(kb) {
                if (kb === 0) return '0 KB';
                const sizes = ['KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(kb) / Math.log(1024));
                if (i === 0) {
                    return `${kb.toFixed(0)} ${sizes[i]}`;
                }
                return `${(kb / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;
            }

            function displayResult(wrapper_id, result_id, value, isError = false) {
                const wrapper = document.getElementById(wrapper_id);
                const result = document.getElementById(result_id);
                
                wrapper.classList.remove('hidden');
                result.textContent = value;
                
                if (isError) {
                    result.classList.remove('text-teal-300');
                    result.classList.add('text-pink-400');
                    result.classList.replace('text-3xl', 'text-lg');
                } else {
                    result.classList.add('text-teal-300');
                    result.classList.remove('text-pink-400');
                    result.classList.replace('text-lg', 'text-3xl');
                }
            }

            // --- Calculator 1: Estimate Final Size ---
            document.getElementById('calculate_size').addEventListener('click', () => {
                const totalSeconds = parseTimeToSeconds('total_hh', 'total_mm', 'total_ss');
                const sampleSeconds = parseTimeToSeconds('sample_hh', 'sample_mm', 'sample_ss');
                const sampleSizeInKB = parseSizeToKB('sample_size', 'sample_unit');

                if (totalSeconds === 0) {
                    displayResult('size_result_wrapper', 'size_result', 'Total Video Length cannot be zero.', true);
                    return;
                }
                if (sampleSeconds === 0) {
                    displayResult('size_result_wrapper', 'size_result', 'Sample Length cannot be zero.', true);
                    return;
                }
                if (sampleSizeInKB === 0) {
                    displayResult('size_result_wrapper', 'size_result', 'Sample File Size cannot be zero.', true);
                    return;
                }

                const multiplier = totalSeconds / sampleSeconds;
                const totalSizeInKB = multiplier * sampleSizeInKB;
                const finalSize = formatSize(totalSizeInKB);

                displayResult('size_result_wrapper', 'size_result', finalSize);
            });

            // --- Calculator 2: Find Required Bitrate ---
            document.getElementById('calculate_bitrate').addEventListener('click', () => {
                const totalSeconds = parseTimeToSeconds('target_hh', 'target_mm', 'target_ss');
                const targetSizeInKB = parseSizeToKB('target_size', 'target_unit');
                const audioBitrate = parseInt(document.getElementById('audio_bitrate').value) || 0;

                if (totalSeconds === 0) {
                    displayResult('bitrate_result_wrapper', 'bitrate_result', 'Total Video Length cannot be zero.', true);
                    return;
                }
                if (targetSizeInKB === 0) {
                    displayResult('bitrate_result_wrapper', 'bitrate_result', 'Target File Size cannot be zero.', true);
                    return;
                }

                const totalBitrateNeeded = (targetSizeInKB * 8) / totalSeconds;
                
                if (totalBitrateNeeded <= audioBitrate) {
                     displayResult('bitrate_result_wrapper', 'bitrate_result', 'Target size is too small, even for the audio.', true);
                     return;
                }

                const videoBitrateNeeded = totalBitrateNeeded - audioBitrate;
                const finalBitrate = `${videoBitrateNeeded.toFixed(0)} kbps`;
                
                displayResult('bitrate_result_wrapper', 'bitrate_result', finalBitrate);
            });

            // --- AI Modal Selectors ---
            const askAiBtn = document.getElementById('ask-ai-btn');
            const aiModal = document.getElementById('ai-modal');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const aiQuestionInput = document.getElementById('ai-question-input');
            const submitAiQuestionBtn = document.getElementById('submit-ai-question-btn');
            const modalLoader = document.getElementById('modal-loader');
            const modalResultContainer = document.getElementById('modal-result-container');
            const modalText = document.getElementById('modal-text');
            const modalFooter = document.getElementById('modal-footer');
            const copyBtn = document.getElementById('copy-btn');

            // --- Modal Control Functions ---
            const showModal = () => {
                aiModal.classList.remove('hidden', 'opacity-0');
                setTimeout(() => {
                    modalContent.classList.remove('opacity-0', 'scale-95');
                }, 10);
            };

            const hideModal = () => {
                modalContent.classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    aiModal.classList.add('hidden', 'opacity-0');
                    modalResultContainer.classList.add('hidden');
                    modalLoader.classList.add('hidden');
                    aiQuestionInput.value = '';
                }, 300);
            };
            
            const showLoader = () => {
                modalLoader.classList.remove('hidden');
                modalResultContainer.classList.add('hidden');
                modalFooter.classList.add('hidden');
            };

            const showResult = (text) => {
                modalLoader.classList.add('hidden');
                modalText.innerText = text;
                modalResultContainer.classList.remove('hidden');
                modalFooter.classList.remove('hidden');
            };

            // --- Gemini API Call via Secure Worker ---
            async function callGemini(prompt) {
                const apiUrl = 'https://dubbc-ai-proxy.wcornelius.workers.dev/';
                const payload = { prompt: prompt };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0) {
                        return result.candidates[0].content.parts[0].text.trim();
                    } else {
                        throw new Error('Unexpected API response format');
                    }
                } catch (error) {
                    console.error('Error calling the proxy worker:', error);
                    return `An error occurred: ${error.message}. Please try again later.`;
                }
            }

            // --- AI Modal Event Handlers ---
            if(askAiBtn) {
                askAiBtn.addEventListener('click', showModal);
            }

            if(submitAiQuestionBtn) {
                submitAiQuestionBtn.addEventListener('click', async () => {
                    const question = aiQuestionInput.value;
                    if (!question.trim()) {
                        showResult('Please enter a question.');
                        return;
                    }
                    showLoader();
                    // This prompt is customized for the video calculator page
                    const fullPrompt = `You are a helpful, friendly AI assistant specializing in video editing. Your knowledge base includes video bitrates, file sizes, codecs, containers (MP4, MKV), and best practices for platforms like YouTube, Kick, and Twitch. You are helping a user on a bitrate calculator page. Answer the user's question concisely: "${question}"`;
                    const resultText = await callGemini(fullPrompt);
                    showResult(resultText);
                });
            }
            
            if(aiQuestionInput) {
                aiQuestionInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') submitAiQuestionBtn.click();
                });
            }

            if(closeModalBtn) {
                closeModalBtn.addEventListener('click', hideModal);
            }
            
            if(aiModal) {
                aiModal.addEventListener('click', (e) => {
                    if (e.target === aiModal) hideModal();
                });
            }

            // --- Utility Functions ---
            if(copyBtn) {
                copyBtn.addEventListener('click', () => {
                    const textArea = document.createElement("textarea");
                    textArea.value = modalText.innerText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        copyBtn.innerText = 'Copied!';
                        setTimeout(() => { copyBtn.innerText = 'Copy Text'; }, 2000);
                    } catch (err) {
                        console.error('Fallback: Oops, unable to copy', err);
                    }
                    document.body.removeChild(textArea);
                });
            }
        });
    </script>
</body>
</html>
